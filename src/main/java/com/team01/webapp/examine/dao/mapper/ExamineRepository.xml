<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team01.webapp.examine.dao.IExamineRepository">
	
	<select id="count" resultType="int">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<select id="list" parameterType="map" resultType="examine">
		<![CDATA[
			SELECT
			    SR_NO AS "srNo",
			    SR_TTL AS "srTtl",
			    SR_REG_DATE AS "srRegDate",
			    SR_DDLN_DATE AS "srDdlnDate",
			    SR_PRY AS "srPry",
			    USER_NM AS "userNm",
			    USER_OGDP AS "userOgdp",
			    USER_DP_NM AS "userDpNm",
			    STTS_NM AS "sttsNm",
			    SYS_NM "sysNm",
			    RNUM AS "seq"
			FROM(
			    SELECT
			        SR_NO,
			        SR_TTL,
			        SR_REG_DATE,
			        SR_DDLN_DATE,
			        SR_PRY,
			        USER_NM,
			        USER_OGDP,
			        USER_DP_NM,
			        STTS_NM,
			        SYS_NM,
			        ROWNUM AS RNUM
			    FROM(
			        SELECT 
			            s.SR_NO,
			            s.SR_TTL,
			            s.SR_REG_DATE,
			            s.SR_DDLN_DATE,
			            s.SR_PRY,
			            u.USER_NM,
			            u.USER_OGDP,
			            u.USER_DP_NM,
			            st.STTS_NM,
			            SYS_NM
			        FROM SR s
			        LEFT OUTER JOIN USERS u
			        ON s.SR_CUST_NO = u.USER_NO
			        LEFT OUTER JOIN SR_STTS st
			        ON s.STTS_NO = st.STTS_NO
			        LEFT OUTER JOIN SYSTEM sys
			        ON s.SYS_NO = sys.SYS_NO
			       	WHERE st.STTS_NO = #{sttsNo}
			       	
			        ORDER BY s.SR_NO
			    )
			    WHERE ROWNUM <=#{endRowNo}
			)
			WHERE ROWNUM >=#{startRowNo}
		]]>
	</select>
	
	<!-- 요청 진행 상태 리스트 -->
	<select id="selectSrSttsList" resultType="srstts">
		SELECT 
		    STTS_NO AS "sttsNo",
		    STTS_NM AS "sttsNm"
		FROM SR_STTS
	</select>

	<!-- 관련 시스템 리스트 -->
	<select id="selectSysNmList" resultType="system">
		SELECT 
			SYS_NO AS "sysNo",
			SYS_NM AS "sysNm"
		FROM SYSTEM
	</select>
	
	<!-- 등록자 소속 및 부서 리스트 -->
	<select id="selectUserOgdpList" resultType="users">
		SELECT 
		    DISTINCT(USER_OGDP) AS "userOgdp"
		FROM USERS
		WHERE USER_TYPE='고객사'
	</select>
	
	<select id="selectUserDpList" resultType="users">
		SELECT 
		    DISTINCT(USER_DP_NM) AS "userDpNm"
		FROM USERS
		WHERE USER_TYPE='고객사'
	</select>

</mapper>
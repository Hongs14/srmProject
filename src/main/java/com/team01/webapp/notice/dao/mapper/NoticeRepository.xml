<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team01.webapp.notice.dao.INoticeRepository">
	
	<select id="count" resultType="int">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<!-- 게시글 목록 -->
	<select id="list" parameterType="pager" resultType="notice">
		<![CDATA[
			SELECT 
			    RNUM AS "seq",
			    NTC_NO AS "ntcNo",
			    USER_ID AS "userId",
			    NTC_TTL AS "ntcTtl",
			    NTC_INQ_CNT AS "ntcInqCnt",
			    NTC_WRT_DATE AS "ntcWrtDate"
			FROM(
			    SELECT 
			        NTC_NO,
			        NTC_TTL,
			        NTC_INQ_CNT,
			        NTC_WRT_DATE,
			        NTC_PRY,
			        USER_ID,
			        ROWNUM as RNUM

			    FROM(
			        SELECT 
			            n.NTC_NO,
			            n.NTC_TTL,
			            n.NTC_INQ_CNT,
			            n.NTC_WRT_DATE,
			            n.NTC_PRY,
			            u.USER_ID
			        FROM NOTICE n, USERS u
			        WHERE n.user_no = u.user_no
			        ORDER BY n.ntc_pry
			    )
			    WHERE ROWNUM <=#{endRowNo}
			)
			WHERE rnum >=#{startRowNo}
		]]>
	</select>
	
	<!-- 게시글 작성 -->
	<insert id="write" parameterType="notice">
		<selectKey keyProperty="ntcNo" resultType="int" order="BEFORE">
			SELECT ntcno_seq.nextval FROM dual
		</selectKey>
		<if test="ntcFileActlNm == null">
			<![CDATA[
				INSERT INTO NOTICE( NTC_NO, USER_NO, NTC_TTL, NTC_CN, NTC_INQ_CNT, NTC_WRT_DATE, NTC_PRY)
				VALUES( ntcno_seq.nextval, #{userNo}, #{ntcTtl}, #{ntcCn}, 0, sysdate, #{ntcPry} ) 
			]]>
		</if>
		<if test="ntcFileActlNm != null">
			<![CDATA[
				INSERT INTO NOTICE( NTC_NO, USER_NO, NTC_TTL, NTC_CN, NTC_INQ_CNT, NTC_WRT_DATE, NTC_PRY, NTC_FILE_PHYS_NM, NTC_FILE_ACTL_NM, NTC_FILE_EXTN_NM)
				VALUES( ntcno_seq.nextval, #{userNo}, #{ntcTtl}, #{ntcCn}, 0, sysdate, #{ntcPry}, #{ntcFilePhysNm}, #{ntcFileActlNm}, #{ntcFileExtnNm} ) 
			]]>
		</if>
		
	</insert>
	
	<!-- 첨부파일 -->
	<insert id="noticeFileUpload" parameterType="notice">
		<![CDATA[
			INSERT INTO NTC_FILE( NTC_FILE_NO, NTC_NO, NTC_FILE_PHYS_NM, NTC_FILE_ACTL_NM, NTC_FILE_EXTN_NM)
			VALUES( ntcFileNo_seq.nextval, #{ntcNo}, #{ntcFilePhysNm}, #{ntcFileActlNm}, #{ntcFileExtnNm})
		]]>
	</insert>
	

	<!-- 게시글 상세조회 -->
	<select id="detail" parameterType="int" resultType="notice">
		<![CDATA[
			
			SELECT 
			    n.NTC_TTL AS ntcTtl,
			    n.NTC_NO AS ntcNo,
			    u.USER_ID AS userId,
			    n.NTC_PRY AS ntcPry,
			    n.NTC_WRT_DATE AS ntcWrtDate,
			    n.NTC_CN AS ntcCn
			FROM NOTICE n , USERS u
			WHERE NTC_NO = #{ntcNo}
			AND n.user_no = u.user_no
		
		]]>
		
	</select>
	
</mapper>